import{_ as S,u as x,r as g,m as D,c as l,a as s,b as m,d as y,v as R,A as U,f as c,p as k,F as u,q as v,e as n,t as i,j as T,i as A,o,g as C,h as B,B as N}from"./index-CTcaoqbD.js";import{u as L}from"./post-DgZ19Mv9.js";import"./PostUpload.vue_vue_type_style_index_0_scoped_bb851dd0_lang-DSBaiVOZ.js";import{R as M}from"./RatingStars-DjcioSH3.js";const j={class:"feed-page"},q={class:"filters-container"},E={class:"search-bar"},I={class:"filter-dropdowns"},z=["value"],K=["value"],$={key:0,class:"status-message"},G={key:1,class:"error-message"},H={key:2,class:"status-message"},J={key:3,class:"post-list"},O={class:"post-header"},Q=["src"],W={class:"post-info"},X={class:"post-author"},Y={class:"post-date"},Z={class:"post-title"},ee={class:"post-detail"},se={class:"post-detail"},te={key:0,class:"post-file-preview-container"},le=["src","alt"],oe=["href"],ae=["src","alt"],re=["href"],ie=["href"],ne={class:"generic-file-icon-preview"},ue=["href"],ce={key:4,class:"pagination-bar"},de=["onClick","disabled"],fe={class:"page-status"},_e={__name:"Resources",setup(pe){const a=L(),h=x();T();const d=g(""),f=g(""),_=g(""),p=()=>{const r={searchTerm:d.value,course:f.value,cycle:_.value,authorRole:"admin"};a.fetchPosts(r)},b=()=>{d.value="",f.value="",_.value="",p()},w=r=>{if(!r)return!1;const t=r.toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(t)},P=r=>r?r.toLowerCase()==="pdf":!1;D(async()=>{if(h.user)try{await h.fetchUserProfile(h.user.id),await Promise.all([a.fetchUniqueCourses(),a.fetchUniqueCycles()]),await a.fetchPosts({authorRole:"admin",reset:!0}),notificationStore.setupRealtimeNotifications()}catch(r){console.error("Initialization error:",r)}});const F=async r=>{await a.fetchPosts({page:r,searchTerm:d.value,course:f.value,cycle:_.value,reset:!0}),window.scrollTo({top:0,behavior:"smooth"})};return(r,t)=>{const V=A("router-link");return o(),l("div",j,[s("div",q,[s("div",E,[y(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>d.value=e),placeholder:"Buscar por tÃ­tulo, curso o ciclo...",onKeyup:U(p,["enter"])},null,544),[[R,d.value]]),s("button",{onClick:p,class:"search-button"},t[3]||(t[3]=[s("i",{class:"fas fa-search"},null,-1),c(" Buscar ")])),d.value||f.value||_.value?(o(),l("button",{key:0,onClick:b,class:"clear-filters-button"}," Limpiar Filtros ")):m("",!0)]),s("div",I,[y(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>_.value=e),onChange:p,class:"filter-select"},[t[4]||(t[4]=s("option",{value:""},"Todos los Ciclos",-1)),(o(!0),l(u,null,v(n(a).cycles,e=>(o(),l("option",{key:e,value:e},i(e),9,z))),128))],544),[[k,_.value]]),y(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>f.value=e),onChange:p,class:"filter-select"},[t[5]||(t[5]=s("option",{value:""},"Todos los Cursos",-1)),(o(!0),l(u,null,v(n(a).courses,e=>(o(),l("option",{key:e,value:e},i(e),9,K))),128))],544),[[k,f.value]])])]),n(a).loading?(o(),l("p",$,"Cargando recursos...")):n(a).error?(o(),l("p",G,"Error al cargar recursos: "+i(n(a).error),1)):n(a).posts.length===0?(o(),l("p",H,"No hay recursos disponibles.")):(o(),l("div",J,[(o(!0),l(u,null,v(n(a).posts,e=>(o(),l("div",{key:e.id,class:"post-item"},[s("div",O,[C(V,{to:`/users/${e.user_id}`,class:"post-author-link"},{default:B(()=>[s("img",{src:e.avatar_url||"https://via.placeholder.com/40/CCCCCC/FFFFFF?text=AV",alt:"Avatar del autor",class:"post-avatar"},null,8,Q)]),_:2},1032,["to"]),s("div",W,[s("span",X,i(e.alias||e.email||"Usuario Desconocido"),1),s("span",Y,i(new Date(e.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric"})),1)])]),s("h4",Z,[s("strong",null,i(e.title),1)]),s("p",ee,[t[6]||(t[6]=s("strong",null,"Curso:",-1)),c(" "+i(e.course),1)]),s("p",se,[t[7]||(t[7]=s("strong",null,"Ciclo:",-1)),c(" "+i(e.cycle),1)]),e.file_url?(o(),l("div",te,[e.thumbnail_url?(o(),l(u,{key:0},[s("img",{src:e.thumbnail_url,alt:e.title,class:"file-preview-thumbnail"},null,8,le),s("a",{href:e.file_url,target:"_blank",rel:"noopener noreferrer",class:"file-link-overlay"},t[8]||(t[8]=[s("i",{class:"fas fa-eye"},null,-1),c(" Ver Completo ")]),8,oe)],64)):w(e.file_type)?(o(),l(u,{key:1},[s("img",{src:e.file_url,alt:e.title,class:"file-preview-image"},null,8,ae),s("a",{href:e.file_url,target:"_blank",rel:"noopener noreferrer",class:"file-link-overlay"},t[9]||(t[9]=[s("i",{class:"fas fa-eye"},null,-1),c(" Ver Completo ")]),8,re)],64)):P(e.file_type)?(o(),l(u,{key:2},[t[11]||(t[11]=s("div",{class:"pdf-icon-preview"},[s("i",{class:"fas fa-file-pdf fa-5x"}),s("p",null,"Documento PDF")],-1)),s("a",{href:e.file_url,target:"_blank",rel:"noopener noreferrer",class:"file-link-overlay"},t[10]||(t[10]=[s("i",{class:"fas fa-eye"},null,-1),c(" Ver Completo ")]),8,ie)],64)):(o(),l(u,{key:3},[s("div",ne,[t[12]||(t[12]=s("i",{class:"fas fa-file-alt fa-5x"},null,-1)),s("p",null,"Archivo "+i(e.file_type?e.file_type.toUpperCase():""),1)]),s("a",{href:e.file_url,target:"_blank",rel:"noopener noreferrer",class:"file-link-overlay"},t[13]||(t[13]=[s("i",{class:"fas fa-download"},null,-1),c(" Descargar Archivo ")]),8,ue)],64))])):m("",!0),C(M,{"post-id":e.id,"initial-average-rating":e.average_rating,"initial-user-rating":e.user_rating},null,8,["post-id","initial-average-rating","initial-user-rating"])]))),128))])),r.totalPages>1?(o(),l("div",ce,[(o(!0),l(u,null,v(r.totalPages,e=>(o(),l("button",{key:e,class:N({"active-page":e===n(a).currentPage}),onClick:ve=>F(e),disabled:e===n(a).currentPage},i(e),11,de))),128))])):m("",!0),s("p",fe," Mostrando "+i(n(a).posts.length)+" de "+i(n(a).total)+" publicaciones ",1)])}}},ke=S(_e,[["__scopeId","data-v-4626032d"]]);export{ke as default};
