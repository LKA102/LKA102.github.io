import{C as $,x as f,_ as m,u as A,c as n,o as a,a as t,e as i,F as C,q as S,t as u,f as h,B as _,r as U,m as w,l as E,g,D as b,b as p}from"./index-DyqqpZWw.js";const y=$("admin",{state:()=>({users:[],verificationCodes:[],loading:!1,error:null,totalUsers:0,totalPosts:0,totalUnusedCodes:0,totalStudents:0}),actions:{async fetchAllUsers(){this.loading=!0,this.error=null;try{const{data:s,error:e}=await f.from("users").select("id, alias, email, role, created_at");if(e)throw e;this.users=s||[],console.log("AdminStore: Usuarios cargados para la lista:",this.users)}catch(s){this.error=s.message,console.error("AdminStore: Error fetching all users:",s.message)}finally{this.loading=!1}},async deleteUser(s){this.loading=!0,this.error=null;try{console.log(`Attempting to delete from 'students' for userId: ${s}`);const{error:e}=await f.from("students").delete().eq("user_id",s);if(e)throw console.error("Error deleting from students table:",e),new Error(`Failed to delete from students table: ${e.message}`);console.log("Deleted from students table successfully."),console.log(`Attempting to delete from 'users' table for userId: ${s}`);const{error:r}=await f.from("users").delete().eq("id",s);if(r)throw console.error("Error deleting from users table:",r),new Error(`Failed to delete from users table: ${r.message}`);console.log("Deleted from users table successfully."),this.users=this.users.filter(d=>d.id!==s),await this.fetchTotalUsers(),alert("Usuario y datos asociados eliminados con éxito.")}catch(e){this.error=e.message,console.error("AdminStore: Global Error during user deletion:",e.message),alert(`Error al eliminar usuario: ${e.message}. Revisa la consola para más detalles.`)}finally{this.loading=!1}},async fetchVerificationCodes(){this.loading=!0,this.error=null;try{const{data:s,error:e,count:r}=await f.from("verifications").select("code, email",{count:"exact"}).order("code",{ascending:!0});if(e)throw e;this.verificationCodes=s||[],this.totalUnusedCodes=s.length,console.log("AdminStore: Códigos de verificación cargados:",this.verificationCodes,"Total:",this.totalUnusedCodes)}catch(s){this.error=s.message,console.error("AdminStore: Error fetching verification codes:",s.message)}finally{this.loading=!1}},async deleteVerificationCode(s){this.loading=!0,this.error=null;try{const{error:e}=await f.from("verifications").delete().eq("code",s);if(e)throw e;this.verificationCodes=this.verificationCodes.filter(r=>r.code!==s),this.totalUnusedCodes=this.verificationCodes.length,alert("Código de verificación eliminado con éxito.")}catch(e){this.error=e.message,console.error("AdminStore: Error deleting verification code:",e.message),alert(`Error al eliminar código: ${e.message}`)}finally{this.loading=!1}},async fetchTotalPosts(){this.loading=!0,this.error=null;try{const{count:s,error:e}=await f.from("posts").select("*",{count:"exact",head:!0});if(e)throw e;this.totalPosts=s||0,console.log("AdminStore: Total de publicaciones:",this.totalPosts)}catch(s){this.error=s.message,console.error("AdminStore: Error fetching total posts:",s.message)}finally{this.loading=!1}},async fetchTotalUsers(){this.loading=!0,this.error=null;try{const{count:s,error:e}=await f.from("users").select("*",{count:"exact",head:!0});if(e)throw e;this.totalUsers=s||0,console.log("AdminStore: Total de usuarios:",this.totalUsers)}catch(s){this.error=s.message,console.error("AdminStore: Error fetching total users count:",s.message)}finally{this.loading=!1}},async fetchTotalStudents(){this.loading=!0,this.error=null;try{const{count:s,error:e}=await f.from("students").select("*",{count:"exact",head:!0});if(e)throw e;this.totalStudents=s||0,console.log("AdminStore: Total de estudiantes:",this.totalStudents)}catch(s){this.error=s.message,console.error("AdminStore: Error fetching total students:",s.message)}finally{this.loading=!1}},async fetchAllMetrics(){this.loading=!0,this.error=null;try{await Promise.all([this.fetchTotalUsers(),this.fetchTotalPosts(),this.fetchTotalStudents(),this.fetchVerificationCodes()])}catch(s){this.error=s.message,console.error("AdminStore: Error fetching all metrics:",s.message)}finally{this.loading=!1}}}}),k={class:"user-list-container"},T={key:0,class:"no-data-message"},x={key:1,class:"table-responsive"},V={class:"user-table"},q=["onClick","disabled"],D={__name:"UserList",setup(s){const e=y(),r=A(),d=async(o,l)=>{var c;if(((c=r.user)==null?void 0:c.id)===o){alert("No puedes eliminar tu propia cuenta de administrador.");return}confirm(`¿Estás seguro de que quieres eliminar al usuario ${l}? Esta acción es irreversible.`)&&await e.deleteUser(o)};return(o,l)=>(a(),n("div",k,[l[2]||(l[2]=t("h3",null,"Lista de Usuarios",-1)),i(e).users.length===0&&!i(e).loading&&!i(e).error?(a(),n("p",T," No hay usuarios registrados. ")):(a(),n("div",x,[t("table",V,[l[1]||(l[1]=t("thead",null,[t("tr",null,[t("th",null,"Alias"),t("th",null,"Email"),t("th",null,"Rol"),t("th",null,"Fecha de Creación"),t("th",null,"Acciones")])],-1)),t("tbody",null,[(a(!0),n(C,null,S(i(e).users,c=>(a(),n("tr",{key:c.id},[t("td",null,u(c.alias),1),t("td",null,u(c.email),1),t("td",null,u(c.role),1),t("td",null,u(new Date(c.created_at).toLocaleDateString()),1),t("td",null,[t("button",{onClick:te=>d(c.id,c.alias),class:"delete-button",disabled:c.role==="admin"||i(e).loading},l[0]||(l[0]=[t("i",{class:"fas fa-trash-alt"},null,-1),h(" Eliminar ")]),8,q)])]))),128))])])]))]))}},P=m(D,[["__scopeId","data-v-69e1cc9a"]]),N={class:"verification-codes-container"},L={key:0,class:"no-data-message"},B={key:1,class:"table-responsive"},F={class:"codes-table"},M=["onClick","disabled"],G={__name:"VerificationCodeList",setup(s){const e=y(),r=async d=>{confirm(`¿Estás seguro de que quieres eliminar el código ${d}?`)&&await e.deleteVerificationCode(d)};return(d,o)=>(a(),n("div",N,[o[2]||(o[2]=t("h3",null,"Códigos de Verificación",-1)),i(e).verificationCodes.length===0&&!i(e).loading&&!i(e).error?(a(),n("p",L," No hay códigos de verificación registrados. ")):(a(),n("div",B,[t("table",F,[o[1]||(o[1]=t("thead",null,[t("tr",null,[t("th",null,"Código"),t("th",null,"Email"),t("th",null,"Acciones")])],-1)),t("tbody",null,[(a(!0),n(C,null,S(i(e).verificationCodes,l=>(a(),n("tr",{key:l.code},[t("td",null,u(l.code),1),t("td",null,u(l.email),1),t("td",null,[t("button",{onClick:c=>r(l.code),class:"delete-button",disabled:i(e).loading},o[0]||(o[0]=[t("i",{class:"fas fa-trash-alt"},null,-1),h(" Eliminar ")]),8,M)])]))),128))])])]))]))}},R=m(G,[["__scopeId","data-v-afb0c3f5"]]),z={class:"analytics-card"},I={class:"card-icon"},j={class:"card-content"},H={class:"card-value"},J={class:"card-title"},K={__name:"AnalyticsCard",props:{title:{type:String,required:!0},value:{type:[String,Number],required:!0},icon:{type:String,default:"fas fa-info-circle"}},setup(s){return(e,r)=>(a(),n("div",z,[t("div",I,[t("i",{class:_(s.icon)},null,2)]),t("div",j,[t("div",H,u(s.value),1),t("div",J,u(s.title),1)])]))}},v=m(K,[["__scopeId","data-v-4d8a6732"]]),O={class:"admin-dashboard"},Q={class:"analytics-cards-container"},W={class:"dashboard-tabs"},X={class:"tab-content"},Y={key:0,class:"loading-message"},Z={key:1,class:"error-message"},ee={key:2},se={__name:"Dashboard",setup(s){const e=y(),r=U("users");return w(()=>{e.fetchAllMetrics(),r.value==="users"?e.fetchAllUsers():r.value==="verifications"&&e.fetchVerificationCodes()}),E(r,d=>{d==="users"?e.fetchAllUsers():d==="verifications"&&e.fetchVerificationCodes()}),(d,o)=>(a(),n("div",O,[o[5]||(o[5]=t("h2",null,"Panel de Administración",-1)),t("div",Q,[g(v,{title:"Total Usuarios",value:i(e).totalUsers,icon:"fas fa-users",class:"users"},null,8,["value"]),g(v,{title:"Total Estudiantes",value:i(e).totalStudents,icon:"fas fa-graduation-cap",class:"students"},null,8,["value"]),g(v,{title:"Total Publicaciones",value:i(e).totalPosts,icon:"fas fa-file-alt",class:"posts"},null,8,["value"])]),t("div",W,[t("button",{class:_({active:r.value==="users"}),onClick:o[0]||(o[0]=l=>r.value="users")},o[2]||(o[2]=[t("i",{class:"fas fa-users"},null,-1),h(" Gestión de Usuarios ")]),2),t("button",{class:_({active:r.value==="verifications"}),onClick:o[1]||(o[1]=l=>r.value="verifications")},o[3]||(o[3]=[t("i",{class:"fas fa-clipboard-check"},null,-1),h(" Códigos de Verificación ")]),2)]),t("div",X,[i(e).loading?(a(),n("div",Y,o[4]||(o[4]=[t("i",{class:"fas fa-spinner fa-spin"},null,-1),h(" Cargando datos... ")]))):i(e).error?(a(),n("div",Z," Error: "+u(i(e).error),1)):(a(),n("div",ee,[r.value==="users"?(a(),b(P,{key:0})):p("",!0),r.value==="verifications"?(a(),b(R,{key:1})):p("",!0)]))])]))}},re=m(se,[["__scopeId","data-v-83ec8431"]]);export{re as default};
