import{_ as N,u as S,r as c,l as U,m as L,c as l,t as o,a as e,f as u,F as g,q as j,k as q,o as t,b as C,g as B,x as w}from"./index-CTcaoqbD.js";import{R as I}from"./RatingStars-DjcioSH3.js";import"./post-DgZ19Mv9.js";const M={class:"profile-page"},$={key:0,class:"status-message"},z={key:1,class:"error-message"},G={key:2,class:"status-message"},H={key:3,class:"profile-details"},J={class:"avatar-section"},K=["src","alt"],O={class:"profile-info-group"},Q={class:"user-posts-section"},W={key:0,class:"status-message"},X={key:1,class:"error-message"},Y={key:2,class:"status-message"},Z={key:3,class:"post-list"},T={class:"post-header"},ee=["src"],ae={class:"post-info"},se={class:"post-author"},re={class:"post-date"},le={class:"post-title"},te={class:"post-detail"},ie={class:"post-detail"},oe={key:0,class:"post-file-preview-container"},ne=["src","alt"],ue=["href"],ce=["src","alt"],de=["href"],fe=["href"],ge={class:"generic-file-icon-preview"},_e=["href"],ve={key:1,class:"file-download-action"},pe=["href"],me={__name:"UserProfileView",setup(he){const b=q(),h=S(),i=c(null),_=c(!0),d=c(null),v=c([]),p=c(!0),f=c(null),m=c(null),F=async r=>{if(_.value=!0,d.value=null,i.value=null,!r){d.value="ID de usuario no proporcionado.",_.value=!1;return}try{const{data:a,error:s}=await w.from("users").select("id, email, alias, avatar_url, role").eq("id",r).single();if(s)throw s;i.value=a}catch(a){d.value=a.message||"Error desconocido al cargar la información del perfil.",console.error("Error fetching user profile:",a)}finally{_.value=!1}},E=async r=>{if(p.value=!0,f.value=null,v.value=[],!r){f.value="ID de usuario no proporcionado para publicaciones.",p.value=!1;return}try{const{data:a,error:s}=await w.from("posts").select(`
        *,
        users (alias, email, avatar_url, role),
        ratings (rating, user_id)
      `).eq("user_id",r).order("created_at",{ascending:!1});if(s)throw s;v.value=a.map(n=>{var k;const V=n.ratings?n.ratings.reduce((y,R)=>y+R.rating,0):0,x=n.ratings&&n.ratings.length>0?V/n.ratings.length:0,A=n.ratings?(k=n.ratings.find(y=>y.user_id===m.value))==null?void 0:k.rating:null;return{...n,average_rating:x,user_rating:A}})}catch(a){f.value=a.message||"Error desconocido al cargar las publicaciones.",console.error("Error fetching user posts:",a)}finally{p.value=!1}};U(()=>b.params.userId,async r=>{var a;r&&(m.value||(m.value=(a=h.user)==null?void 0:a.id),await Promise.all([F(r),E(r)]))},{immediate:!0});const D=r=>{if(!r)return!1;const a=r.toLowerCase();return["image/jpeg","image/png","image/gif","image/bmp","image/webp","jpg","jpeg","png","gif","bmp","webp"].includes(a)},P=r=>r?r.toLowerCase()==="application/pdf"||r.toLowerCase()==="pdf":!1;return L(async()=>{h.user?m.value=h.user.id:console.warn("No user logged in. Rating functionality might be limited.")}),(r,a)=>(t(),l("div",M,[_.value?(t(),l("section",$," Cargando perfil... ")):d.value?(t(),l("section",z," Error al cargar el perfil: "+o(d.value),1)):i.value?(t(),l("section",H,[e("h2",null,"Información de "+o(i.value.alias||i.value.email),1),e("div",J,[e("img",{src:i.value.avatar_url||"https://via.placeholder.com/150/CCCCCC/FFFFFF?text=AV",alt:`Avatar de ${i.value.alias||i.value.email}`,class:"profile-main-avatar"},null,8,K)]),e("div",O,[e("p",null,[a[0]||(a[0]=e("strong",null,"Email:",-1)),u(" "+o(i.value.email),1)]),e("p",null,[a[1]||(a[1]=e("strong",null,"Rol:",-1)),u(" "+o(i.value.role||"No especificado"),1)])]),e("section",Q,[e("h2",null,"Publicaciones de "+o(i.value.alias||i.value.email),1),p.value?(t(),l("p",W,"Cargando publicaciones...")):f.value?(t(),l("p",X,"Error al cargar publicaciones: "+o(f.value),1)):v.value.length===0?(t(),l("p",Y,"Este usuario aún no tiene publicaciones.")):(t(),l("div",Z,[(t(!0),l(g,null,j(v.value,s=>{var n;return t(),l("div",{key:s.id,class:"post-item"},[e("div",T,[e("img",{src:((n=s.users)==null?void 0:n.avatar_url)||"https://via.placeholder.com/40/CCCCCC/FFFFFF?text=AV",alt:"Avatar del autor",class:"post-avatar"},null,8,ee),e("div",ae,[e("span",se,o(s.users?s.users.alias||s.users.email:"Usuario Desconocido"),1),e("span",re,o(new Date(s.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric"})),1)])]),e("h4",le,[e("strong",null,o(s.title),1)]),e("p",te,[a[2]||(a[2]=e("strong",null,"Curso:",-1)),u(" "+o(s.course),1)]),e("p",ie,[a[3]||(a[3]=e("strong",null,"Ciclo:",-1)),u(" "+o(s.cycle),1)]),s.file_url?(t(),l("div",oe,[s.thumbnail_url?(t(),l(g,{key:0},[e("img",{src:s.thumbnail_url,alt:s.title,class:"file-preview-thumbnail"},null,8,ne),e("a",{href:s.file_url,target:"_blank",rel:"noopener noreferrer",class:"file-link-overlay"},a[4]||(a[4]=[e("i",{class:"fas fa-eye"},null,-1),u(" Ver Completo ")]),8,ue)],64)):D(s.file_type)?(t(),l(g,{key:1},[e("img",{src:s.file_url,alt:s.title,class:"file-preview-image"},null,8,ce),e("a",{href:s.file_url,target:"_blank",rel:"noopener noreferrer",class:"file-link-overlay"},a[5]||(a[5]=[e("i",{class:"fas fa-eye"},null,-1),u(" Ver Completo ")]),8,de)],64)):P(s.file_type)?(t(),l(g,{key:2},[a[7]||(a[7]=e("div",{class:"pdf-icon-preview"},[e("i",{class:"fas fa-file-pdf fa-5x"}),e("p",null,"Documento PDF")],-1)),e("a",{href:s.file_url,target:"_blank",rel:"noopener noreferrer",class:"file-link-overlay"},a[6]||(a[6]=[e("i",{class:"fas fa-eye"},null,-1),u(" Ver Completo ")]),8,fe)],64)):(t(),l(g,{key:3},[e("div",ge,[a[8]||(a[8]=e("i",{class:"fas fa-file-alt fa-5x"},null,-1)),e("p",null,"Archivo "+o(s.file_type?s.file_type.toUpperCase():""),1)]),e("a",{href:s.file_url,target:"_blank",rel:"noopener noreferrer",class:"file-link-overlay"},a[9]||(a[9]=[e("i",{class:"fas fa-download"},null,-1),u(" Descargar Archivo ")]),8,_e)],64))])):C("",!0),s.file_url?(t(),l("div",ve,[e("a",{href:s.file_url,target:"_blank",rel:"noopener noreferrer",class:"download-button"},a[10]||(a[10]=[e("i",{class:"fas fa-download"},null,-1),u(" Descargar Archivo Completo ")]),8,pe)])):C("",!0),B(I,{"post-id":s.id,"initial-average-rating":s.average_rating,"initial-user-rating":s.user_rating},null,8,["post-id","initial-average-rating","initial-user-rating"])])}),128))]))])])):(t(),l("section",G," Usuario no encontrado. "))]))}},we=N(me,[["__scopeId","data-v-87e922c9"]]);export{we as default};
