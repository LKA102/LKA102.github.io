import{_ as A,y as w,u as E,r as y,z as R,m as q,l as B,n as I,c as s,a as n,b as p,e as c,t as d,F as D,q as M,x as h,o as i,B as z}from"./index-CTcaoqbD.js";const F={class:"notifications-page"},L={class:"notification-list-container"},V={key:0,class:"status-message"},$={key:1,class:"error-message"},O={key:2,class:"full-notification-list"},T={class:"notification-content"},j=["onClick"],G={key:3,class:"status-message"},H={key:4,class:"pagination-controls"},J=["disabled"],K=["disabled"],f=10,Q={__name:"Notifications",setup(W){const t=w(),u=E(),r=y(1),g=y(0),m=R(()=>Math.ceil(g.value/f)),l=async()=>{var a;const o=(a=u.user)==null?void 0:a.id;if(o){t.loading=!0,t.error=null;try{const{count:e,error:_}=await h.from("notifications").select("*",{count:"exact",head:!0}).eq("user_id",o);if(_)throw _;g.value=e;const k=(r.value-1)*f,x=k+f-1,{data:P,error:v}=await h.from("notifications").select("*").eq("user_id",o).order("created_at",{ascending:!1}).range(k,x);if(v)throw v;t.notifications=P}catch(e){t.error=e.message||"Error al cargar notificaciones paginadas.",console.error("Error loading paginated notifications:",e.message)}finally{t.loading=!1}}},N=()=>{r.value>1&&(r.value--,l())},b=()=>{r.value<m.value&&(r.value++,l())},S=async()=>{await t.markAllAsRead(),l()},C=async o=>{var a;try{const{error:e}=await h.from("notifications").update({read:!0,updated_at:new Date().toISOString()}).eq("id",o).eq("user_id",(a=u.user)==null?void 0:a.id);if(e)throw e;console.log(`Notificación ${o} marcada como leída.`),l()}catch(e){console.error("Error marking single notification as read:",e.message)}};return q(()=>{var o;(o=u.user)!=null&&o.id?(l(),t.setupRealtimeNotifications()):B(()=>u.user,a=>{a!=null&&a.id&&(l(),t.setupRealtimeNotifications())},{immediate:!0})}),I(()=>{t.unsubscribeRealtimeNotifications()}),(o,a)=>(i(),s("div",F,[a[1]||(a[1]=n("h2",null,"Todas tus Notificaciones",-1)),c(t).notifications.length>0&&c(t).unreadNotificationsCount>0?(i(),s("button",{key:0,onClick:S,class:"mark-read-button-page"}," Marcar todas como leídas ")):p("",!0),n("div",L,[c(t).loading?(i(),s("p",V,"Cargando notificaciones...")):c(t).error?(i(),s("p",$,d(c(t).error),1)):c(t).notifications.length>0?(i(),s("ul",O,[(i(!0),s(D,null,M(c(t).notifications,e=>(i(),s("li",{key:e.id,class:z([{unread:!e.read},"notification-item-full"])},[n("div",T,[n("p",null,d(e.message),1),n("small",null,d(new Date(e.created_at).toLocaleString("es-ES")),1)]),e.read?p("",!0):(i(),s("button",{key:0,onClick:_=>C(e.id),class:"mark-single-read"},a[0]||(a[0]=[n("i",{class:"fas fa-check-circle"},null,-1)]),8,j))],2))),128))])):(i(),s("p",G,"No tienes notificaciones.")),c(t).notifications.length>0&&g.value>f?(i(),s("div",H,[n("button",{onClick:N,disabled:r.value===1},"Anterior",8,J),n("span",null,"Página "+d(r.value)+" de "+d(m.value),1),n("button",{onClick:b,disabled:r.value===m.value},"Siguiente",8,K)])):p("",!0)])]))}},Y=A(Q,[["__scopeId","data-v-8d35a8ae"]]);export{Y as default};
